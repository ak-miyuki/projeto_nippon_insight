<!DOCTYPE html>
<html lang="pt-br">

<head>
    <!-- <link rel="shortcut icon" href="../assets/icons/mt_fuji_img.png" type="image/x-icon"> -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>『日本』Nippon Insight | Dashboards</title>


    <link rel="stylesheet" href="./../css/dashboards.css">
    <!-- <link rel="stylesheet" href="./../css/estilo.css" /> -->
    <!-- <link rel="stylesheet" href="./../css/style.css" /> -->
    <script src="../js/sessao.js"></script>
    <!-- <script src="./../js/alerta.js"></script> -->


    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>


    <!--FONT AWESOME-->
    <!-- <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script> -->
</head>

<!-- <body onload=" atualizarFeed()"> -->

<body onload="atualizarPagina()">

    <!------------------------------- HEADER ------------------------------->
    <div class="header">
        <div class="container">
            <h1 class="titulo">『日本』Nippon Insight</h1>
            <ul class="navbar">
                <li>
                    <a href="./dashboard.html">DASHBOARD</a>
                </li>
                <li> | </li>
                <li>
                    <a href="./viagem.html">EDITAR VIAGEM</a>
                </li>
                <li> | </li>
                <li class="agora">
                    <a href="#">ESCOLHAS</a>
                </li>

            </ul>
            <div class="nome-sair">
                <div class="hello">
                    <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
                </div>
                <div>
                    <button class="botao-preto" onclick="limparSessao()">SAIR</button>
                </div>
            </div>

        </div>
    </div>
    <!----------------------------- HEADER END ----------------------------->

    <div class="janela">
        <div class="header-left_escolhas">
            <div class="menu_titulo">
                <h1>Lista de Escolhas</h1>
            </div>

            <div class="conteudo">
                <!-- COLOCAR OS CONTEÚDOS DO MENU -->

                <!-- LUGARES -->
                <div class="menu_block">
                    <h3>&#x1F338; LUGARES:</h3>
                    <span id="span_lugares"> --//-- </span>
                </div>

                <!-- ALIMENTAÇÃO -->
                <div class="menu_block">
                    <h3>&#x1F338; ALIMENTAÇÃO:</h3>
                    <span id="span_alimentacao"> --//-- </span>
                </div>

                <!-- HOSPEDAGEM -->
                <div class="menu_block">
                    <h3>&#x1F338; HOSPEDAGEM:</h3>
                    <span id="span_hospedagem"> --//-- </span>
                </div>

                <!-- TRANSPORTE -->
                <div class="menu_block">
                    <h3>&#x1F338; TRANSPORTE</h3>
                    <span id="span_transporte"> --//-- </span>
                </div>

                <!-- COMUNICAÇÃO -->
                <div class="menu_block">
                    <h3>&#x1F338; COMUNICAÇÃO:</h3>
                    <span id="span_comunicacao"> --//-- </span>
                </div>

            </div>

        </div>

        <div class="opcoes" id="div_escolhas">
            <div id="div_lugar"></div>
            <div id="div_transporte"></div>
            <div id="div_comunicacao"></div>
            <div id="div_hospedagem"></div>
            <div id="div_alimentacao"></div>
            <div class="buttons" id="navegacao_botoes">
                <button id="button_anterior" class="botao" onclick="anterior()">ANTERIOR</button>
                <button id="button_proximo" class="botao" onclick="proximo()">PRÓXIMO</button>
            </div>
        </div>
    </div>


</body>

</html>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    var idViagem = sessionStorage.ID_VIAGEM;
    var lista_tudo = [];
    var indexAtual = 0;

    var listaCategorias = ['Lugar', 'Transporte', 'Comunicação', 'Hospedagem', 'Alimentação'];

    function atualizarPagina() {

        fetch(`/itens/buscarItens`)
            .then(response => response.json())
            .then(listaItens => {

                if (listaItens.length === 0) {
                    alert("errinho: listaItens está vazia");
                } else {

                    console.log(listaItens);
                    lista_tudo = listaItens;

                    mostrarItensPorCategoria();
                }
            })
            .catch(error => console.error('Erro ao buscar dados dos itens:', error));

    }

    function atualizarDisplay() {

        div_lugar.style.display = 'none';
        div_transporte.style.display = 'none';
        div_comunicacao.style.display = 'none';
        div_hospedagem.style.display = 'none';
        div_alimentacao.style.display = 'none';

        var categoria = listaCategorias[indexAtual];

        if (categoria == 'Lugar') div_lugar.style.display = 'block';
        else if (categoria == 'Transporte') div_transporte.style.display = 'block';
        else if (categoria == 'Comunicação') div_comunicacao.style.display = 'block';
        else if (categoria == 'Hospedagem') div_hospedagem.style.display = 'block';
        else div_alimentacao.style.display = 'block';
    }

    function mostrarItensPorCategoria() {

        for (var k = 0; k < listaCategorias.length; k++) {

            var categoriaAtual = listaCategorias[k];
            var itensFiltrados = [];
            var conteudo = "";

            for (var i = 0; i < lista_tudo.length; i++) {
                if (lista_tudo[i].categoria == categoriaAtual) {
                    itensFiltrados[itensFiltrados.length] = lista_tudo[i];
                }
            }

            conteudo = `
            <div id="div_categoria">
                <div class="categoria" id="div_tipo">
                    <h1>${categoriaAtual}</h1>
                </div>
            <br>
        `

            for (var j = 0; j < itensFiltrados.length; j++) {

                var item = itensFiltrados[j];

                conteudo += `
                   <div class="conteudo_info">
                       <div class="foto">
                           <span id="span_foto">${item.foto}</span>
                       </div>

                       <div id="div_info" class="info">
                           <div id="div_nome" class="item_nome">
                               <h2>
                                   <span  id="span_nome">${item.nomeItem}</span>
                               </h2>
                               </div>

                           <div id="div_descricao">
                               <h3>Descrição:</h3>
                               <br>
                                   <span id="span_descricao">${item.descricao}</span>
                           </div>
                        </div>

                           <div class="input_qtd">
                               <h3>Preço unitário:</h3>
                                   <span id="span_preco">${Number(item.preco).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
                               <h3>Quantidade:</h3>
                               <input type="number" id="input_qtd${item.idItem}" placeholder="Ex: 1">
                               <button id="button_salvar" class="botao" onclick="salvar()">SALVAR</button>
                            </div>
                        </div> 
                    `;
            }

            if (categoriaAtual == 'Lugar') {
                div_lugar.innerHTML = conteudo;

            } else if (categoriaAtual == 'Transporte') {
                div_transporte.innerHTML = conteudo;

            } else if (categoriaAtual == 'Comunicação') {
                div_comunicacao.innerHTML = conteudo;

            } else if (categoriaAtual == 'Hospedagem') {
                div_hospedagem.innerHTML = conteudo;

            } else {
                div_alimentacao.innerHTML = conteudo;
            }
        }

        atualizarDisplay();
        atualizarBotoes();
    }


    function atualizarBotoes() {

        if (indexAtual == 0) {
            button_anterior.style.display = 'none'
            button_proximo.style.display = 'block'

        } else if (indexAtual == listaCategorias.length - 1) {
            button_anterior.style.display = 'block'
            button_proximo.style.display = 'none'
        } else {
            button_anterior.style.display = 'block'
            button_proximo.style.display = 'block'
        }

    }


    function proximo() {
        indexAtual++;
        if (indexAtual >= listaCategorias.length) {
            indexAtual = listaCategorias.length - 1;
        }
        mostrarItensPorCategoria();
    }


    function anterior() {
        indexAtual--;
        if (indexAtual < 0) {
            indexAtual = 0;
        }
        mostrarItensPorCategoria();
    }


    function salvar() {
        
        for (var i = 0; i < lista_tudo.length; i++) {

            var item = lista_tudo[i];
            var idInput = "input_qtd" + item.idItem;
            var input = document.getElementById(idInput);
            var qtd = Number(input.value);

            if (qtd > 0) {

                fetch("/escolhas/salvar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        fkViagemServer: idViagem,
                        fkItemServer: item.idItem,
                        qtdServer: qtd
                    })
                })
                    .then(res => res.json())
                    .then(dados => console.log(dados))
                    .catch(erro => console.log("Erro no fetch:", erro));
            }
        }

    }


</script>